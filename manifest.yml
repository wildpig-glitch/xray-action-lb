modules:
  action:
    - key: get-xray-data
      name: Get Xray Data for a Test Issue
      function: getXrayData
      description: Fetches Xray data for a given test issue with user choice of data type.
      inputs:
        issueId:
          title: Issue Id
          type: string
          description: The issue id for the Jira issue that the Xray data is being retrieved for.
          required: true
        dataType:
          title: Data Type
          type: string
          description: The type of data to retrieve (test-steps, preconditions, test-sets, test-plans, test-runs).
          required: false
      actionVerb: GET
    - key: get-test-steps
      name: Get Test Steps
      function: getTestSteps
      description: Fetches test steps, actions, and expected results for a test issue.
      inputs:
        issueId:
          title: Issue Id
          type: string
          description: The issue id for the Jira test issue.
          required: true
      actionVerb: GET
    - key: get-preconditions
      name: Get Test Preconditions
      function: getPreconditions
      description: Fetches preconditions for a test issue.
      inputs:
        issueId:
          title: Issue Id
          type: string
          description: The issue id for the Jira test issue.
          required: true
      actionVerb: GET
    - key: get-test-sets
      name: Get Test Sets
      function: getTestSets
      description: Fetches test sets containing the specified test issue.
      inputs:
        issueId:
          title: Issue Id
          type: string
          description: The issue id for the Jira test issue.
          required: true
      actionVerb: GET
    - key: get-test-plans
      name: Get Test Plans
      function: getTestPlans
      description: Fetches test plans containing the specified test issue.
      inputs:
        issueId:
          title: Issue Id
          type: string
          description: The issue id for the Jira test issue.
          required: true
      actionVerb: GET
    - key: get-test-runs
      name: Get Test Runs
      function: getTestRuns
      description: Fetches execution history and test runs for a test issue.
      inputs:
        issueId:
          title: Issue Id
          type: string
          description: The issue id for the Jira test issue.
          required: true
      actionVerb: GET
    - key: get-user-story
      name: Get User Story
      function: getUserStory
      description: Finds the user story that a given test is testing by looking for the "tests" link type.
      inputs:
        issueId:
          title: Issue Id
          type: string
          description: The issue id for the Jira test issue.
          required: true
      actionVerb: GET
    - key: get-linked-test-cases
      name: Get Linked Test Cases
      function: getLinkedTestCases
      description: Finds all test cases linked to a user story via 'is tested by' or 'tests' relationships.
      inputs:
        issueId:
          title: Issue Id
          type: string
          description: The issue id for the user story to find linked test cases for.
          required: true
      actionVerb: GET
    - key: generate-test-case
      name: Generate Test Case for User Story
      function: generateTestCase
      description: Generates a comprehensive test case for a user story, including test steps, preconditions, and test details.
      inputs:
        userStory:
          title: User Story
          type: string
          description: The user story text or issue key/URL for which to generate a test case.
          required: true
        additionalRequirements:
          title: Additional Requirements
          type: string
          description: Optional additional requirements or acceptance criteria to consider when generating the test case.
          required: false
        projectKey:
          title: Project Key
          type: string
          description: The Jira project key where the test case should be created (e.g., ABC, DEMO).
          required: false
      actionVerb: GET
  rovo:agent:
    - key: xray-action-lb
      name: xray-action-lb
      description: A simple agent to demonstrate the use of custom actions.
      prompt: >
        You are a helpful agent that specializes in Xray test management and test case generation.


        You can perform the following jobs:

        a. Get Xray Data for a Test Issue
        b. Generate Test Case for User Story


        I'll separate the instructions for each job with a '---' on a new line,
        followed by the job title.


        ---

        a. Get Xray Data for a Test Issue

        To do this, follow these steps:

        1. If there is not an issue key in the context, ask for one

        2. fetch the Xray specific data using the get-xray-data action

        3. return the retrieved Xray data to the user

        ---

        b. Generate Test Case for User Story

        To generate a comprehensive test case for a user story, follow these steps:

        1. If the user provides a user story (either as text, Jira issue key, or URL), use the generate-test-case action

        2. If additional requirements are mentioned, include them in the additionalRequirements parameter

        3. If a specific project is mentioned, include the project key in the projectKey parameter

        4. Present the generated test case in a clear, organized format including:
           - Test summary and description
           - Test objective
           - Preconditions
           - Detailed test steps with actions, data, and expected results
           - Acceptance criteria
           Make sure all these sections are well defined and easy to read

        5. All the elements, but particularly the test steps, should be relevant and specific to the provided user story and any additional requirements
        6. DO NOT output to the user the text of the generated test case, you only need to create it, as well as the test steps and the preconditions,
        in Xray using the action and then output the issue key of the created test case
        7. Remind the user that this is a generated test case and should be reviewed and customized as needed

      conversationStarters:
        - retrieve Xray data for this test case
        - get test steps for this issue
        - get test runs for this issue
        - generate a test case for this user story
      actions:
        - get-xray-data
        - get-test-steps
        - get-preconditions
        - get-test-sets
        - get-test-plans
        - get-test-runs
        - get-user-story
        - get-linked-test-cases
        - generate-test-case
  function:
    - key: getXrayData
      handler: index.getXrayData
    - key: getTestSteps
      handler: index.getTestSteps
    - key: getPreconditions
      handler: index.getPreconditions
    - key: getTestSets
      handler: index.getTestSets
    - key: getTestPlans
      handler: index.getTestPlans
    - key: getTestRuns
      handler: index.getTestRuns
    - key: getUserStory
      handler: index.getUserStory
    - key: getLinkedTestCases
      handler: index.getLinkedTestCases
    - key: generateTestCase
      handler: index.generateTestCase
app:
  runtime:
    name: nodejs22.x
    memoryMB: 256
    architecture: arm64
  id: ari:cloud:ecosystem::app/4bef5a04-26c3-4fc1-aed2-3ffa188a86af
permissions:
  scopes:
    - write:jira-work
    - read:jira-work
    - read:chat:rovo
  external:
    fetch:
      backend:
      - 'https://xray.cloud.getxray.app'
